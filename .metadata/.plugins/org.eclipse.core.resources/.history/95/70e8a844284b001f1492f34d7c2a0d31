package com.test.sku.Cereal;

import java.io.*;
import java.net.*;
import java.util.*;

public class DocClient {
	static Scanner kbd = new Scanner(System.in);

	public static void main(String[] args) {
		try {
			Socket s = new Socket("220.67.113.226", 4545);
			DocVO dv = new DocVO();
			FileInfo fi = new FileInfo();
			List<FileInfo> list = new ArrayList<>();

			OutputStream out = s.getOutputStream();
			ObjectOutputStream oos = new ObjectOutputStream(out);
			InputStream in = s.getInputStream();
			ObjectInputStream ois = new ObjectInputStream(in);
			
			while(true) {
				dv = (DocVO)ois.readObject();
				System.out.print(dv.menu + ": ");
				String ms = kbd.nextLine().trim();
				switch(ms) {
					case "a": {
						System.out.print("파일명: ");
						String fname = kbd.nextLine().trim();
						System.out.print("작성자: ");
						String fauth = kbd.nextLine().trim();
						System.out.print("설명: ");
						String fdesc = kbd.nextLine().trim();
						
						byte[] fdata = DocIO.read(fname);
						dv = new DocVO(fname, fdata, fauth, fdesc);
						dv.upload = true;
						dv.fi = fi;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "s": {
						dv.list = true;
						oos.writeObject(dv);
						oos.flush();
	
						System.out.println("*** 파일목록 ***");
						System.out.println("-------------------------");
						list = (List<FileInfo>)ois.readObject();
						for(int i = 0; i < list.size(); i++) {
							int idx = list.indexOf(list.get(i)) + 1;
							System.out.print(idx + "\t");
							System.out.println(list.get(i));
						}
						break;
					}
					case "f": {
						System.out.print("파일번호검색(n) 파일명검색(m): ");
						String fname = kbd.nextLine().trim();
						
						dv.find = true;
						oos.writeObject(dv);
						oos.flush();
						
						
						break;
					}
					case "u": {
						dv.update = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "d": {
						dv.delete = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "x": {
						dv.exit = true;
						oos.writeObject(dv);
						oos.flush();
						System.out.println("프로그램 종료");
						s.close();
						return;
					}
					default: System.err.println("Wrong input!\n"); break;
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		} 
		
	} // end of main
}
