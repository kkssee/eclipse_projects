package com.test.sku.network;

import java.net.*;
import java.io.*;
import java.util.*;

public class Server {
	static Scanner kbd = new Scanner(System.in);
	public static void main(String[] args) {
		// multiple user chatting server
		try {
			ServerSocket ss = new ServerSocket(6000);
			while(true) {
				System.out.println("서버 대기중");
				Socket s = ss.accept();	// 클라이언트가 접속하면 통신용 소켓을 리턴
				// 접속한 이용자와 통신할 때 사용하는 소켓
				System.out.println("클라이언트 접속");
				
				//서버측에서 클라이언트에게 "서버접속 성공" 메시지 전달
				OutputStream out = s.getOutputStream();
				ObjectOutputStream oos = new ObjectOutputStream(out);
				ChatMsg cm = new ChatMsg("서버", "클라이언트", "아이디 암호");
				oos.writeObject(cm);
				oos.flush();

				InputStream in = s.getInputStream();
				ObjectInputStream ois = new ObjectInputStream(in);
				try {
					ChatMsg cm2 = (ChatMsg)ois.readObject();

					System.out.println(cm.uid + " " + cm.pwd);
				} catch (ClassNotFoundException e) {
					// TODO Auto-generated catch block
					e.printStackTrace();
				}

				//문자열을 바이트로 변환해서 내보내야함 -> OutputStreamWriter
				/*OutputStreamWriter osw = new OutputStreamWriter(out);
				PrintWriter pout = new PrintWriter(osw);
				pout.println("아이디 암호: ");
				pout.flush();*/
				
				/*클라이언트로부터 아이디 암호 받기
				InputStream in = s.getInputStream();
				InputStreamReader isr = new InputStreamReader(in);
				BufferedReader br = new BufferedReader(isr);
				String line = br.readLine();
				System.out.println(line);*/
				
			}
		} catch (IOException e) {
			e.printStackTrace();
		}
		System.out.println("서버 종료");
	} // end of main

}
