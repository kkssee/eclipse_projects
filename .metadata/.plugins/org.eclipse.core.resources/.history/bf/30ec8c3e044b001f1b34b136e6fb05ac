package com.test.sku.Cereal;

import java.io.*;
import java.net.*;
import java.util.*;

import com.test.sku.serialization.FileIO;
import com.test.sku.serialization.DocVO;

public class DocClient {
	static Scanner kbd = new Scanner(System.in);

	public static void main(String[] args) {
		try {
			Socket s = new Socket("220.67.113.226", 4545);
			DocVO dv = new DocVO();

			OutputStream out = s.getOutputStream();
			ObjectOutputStream oos = new ObjectOutputStream(out);
			InputStream in = s.getInputStream();
			ObjectInputStream ois = new ObjectInputStream(in);
			
			while(true) {
				dv = (DocVO)ois.readObject();
				System.out.print(dv.menu + ": ");
				String ms = kbd.nextLine().trim();
				switch(ms) {
					case "a": {
						System.out.print("파일명: ");
						String fname = kbd.nextLine().trim();
						System.out.print("작성자: ");
						String fauth = kbd.nextLine().trim();
						System.out.print("설명: ");
						String fdesc = kbd.nextLine().trim();
						
						byte[] fdata = FileIO.read(dv.fname);
						dv = new DocVO(fname, fdata, fauth, fdesc);
						dv.upload = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "s": {
						dv.list = true;
						oos.writeObject(dv);
						oos.flush();
	
						System.out.println("*** 파일목록 ***");
						System.out.println("-------------------------");
						
					
						break;
					}
					case "f": {
						dv.list = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "u": {
						dv.list = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "d": {
						dv.list = true;
						oos.writeObject(dv);
						oos.flush();
						break;
					}
					case "x": {
						dv.exit = true;
						oos.writeObject(dv);
						oos.flush();
						System.out.println("프로그램 종료");
						s.close();
						return;
					}
					default: System.err.println("Wrong input!\n"); break;
				}
			}
		} catch (Exception e) {
			e.printStackTrace();
		} 
		
	} // end of main
}
